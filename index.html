<!DOCTYPE html>
<head>
	<title>zeromq-pusher-googlemaps test</title>

	<style type="text/css"> 
		html { height: 100% }
		body { height: 100%; margin: 0px; padding: 0px }
		#map_canvas { height: 100%; width: 100% }
	</style> 

	<!-- include the Google Maps and Pusher libraries -->
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
	<script type="text/javascript" src="http://js.pusherapp.com/1.8/pusher.min.js"></script>

	<script type="text/javascript"> 
		// this function gets called by the body's onload attribute
		function initialize() {
			// create a standard google map
			var map = new google.maps.Map(document.getElementById("map_canvas"), {
				zoom: 3,
				center: new google.maps.LatLng(30.27,-97.75), // austin
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});
			
			// create a pusher.com client
			var pusher = new Pusher('09b153199c3ffc4e1e41');
			var channel = pusher.subscribe('test_channel');
			var lastInfoWindow;
			
			// register a callback for pusher messages
			channel.bind('my_event', function(message) {
				// log the message for debugging
				console.log(message);
				
				// create a map marker for the message
				var marker = new google.maps.Marker({
					map:      map,
					position: new google.maps.LatLng(message.lat, message.lng),
					title:    'Combine ' + message.combineId
				});
				
				// create an info window for the marker
				var infoWindow = new google.maps.InfoWindow({
					content: "Combine " + message.combineId + '<br/>' +
					  'County: ' + message.county + '<br/>' +
					  'State: ' + message.state + '<br/>' +
					  'Yield: ' + message.yield + '<br/>' +
					  'Time: ' + new Date(message.timestamp).toTimeString()
				});
				
				// show the info window for 3 seconds
				infoWindow.open(map, marker);
				setTimeout(function(){ infoWindow.close(); }, 3000);
			});
		}
	</script> 
</head>

<body onload="initialize()"> 
	<div id="map_canvas"></div> 
</body> 

</html>

<!DOCTYPE html>
<head>
	<title>zeromq2googlemaps</title>

	<style type="text/css"> 
		html { height: 100% }
		body { height: 100%; margin: 0px; padding: 0px }
		#map { height: 100%; width: 100% }
	</style> 
</head>

<body> 
	<div id="map"></div> 

	<!-- include the Google Maps and socket.io libraries -->
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
	<script src="/socket.io/socket.io.js"></script> 

	<script type="text/javascript"> 
		// create a standard google map
		var map = new google.maps.Map(document.getElementById("map"), {
			zoom:      4,
			center:    new google.maps.LatLng(30.27,-97.75), // austin
			mapTypeId: google.maps.MapTypeId.ROADMAP
		});
		
		// register a callback for incoming messages
		var socket = new io.Socket();
		socket.on('message', function(message) {
			// log the message for debugging
			console.log(message);
			
			// create a map marker for the message
			var marker = new google.maps.Marker({
				map:      map,
				position: new google.maps.LatLng(message.lat, message.lng),
				title:    'Combine ' + message.combineId
			});
			
			// create an info window for the marker
			var infoWindow = new google.maps.InfoWindow({
				content:
				  'Combine ' + message.combineId + '<br/>' +
				  'Yield: '  + message.yield + '<br/>' +
				  'Time: '   + new Date(message.timestamp).toTimeString() + '<br/>' +
				  'State: '  + message.state + '<br/>' +
				  'County: ' + message.county
			});
			
			// show the info window for 4 seconds
			infoWindow.open(map, marker);
			setTimeout(function(){
				infoWindow.close();
			}, 1000*4);
		});
		socket.connect();
	</script>
</body> 

</html>
